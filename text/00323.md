## Сервера и развертывание

### Платформа, как сервис (PaaS)

PaaS предоставляет системную и сетевую архитектуры, необходимые для запуска PHP приложений в веб. Это означает, как
минимум, отсутствие настройки для запуска PHP приложений или PHP фреймворков.

В недавнее время PaaS стал очень популярным методом для развертывания, хостирования и расширения PHP приложений
всех размеров.

Примером этого решения может являться [Heroku](https://www.heroku.com/), который позволяет развернуть простое приложение.

### Виртуальный или выделенный сервер

Если вы знакомы с администрированием системы, или заинтересованы в его изучении, виртуальный или выделенный сервер даст вам полный контроль над средой продакшна вашего приложения.

#### nginx и PHP-FPM

PHP, через встроенный в него менеджер процессов FastCGI (FPM), очень хорошо сочетается с [nginx](http://nginx.org), который является легковесным и высокопроизводительным веб-сервером. Он использует меньше памяти, чем Apache и может лучше обрабатывать конкурентные запросы. Это особенно важно на виртуальном сервере, для которого может быть критичен объем используемой памяти.

* [Подробнее о nginx](http://nginx.org)
* [Подробнее о PHP-FPM](http://php.net/manual/ru/install.fpm.php)
* [Подробнее о безопасной установке nginx и PHP-FPM](https://nealpoole.com/blog/2011/04/setting-up-php-fastcgi-and-nginx-dont-trust-the-tutorials-check-your-configuration/)

#### Apache и PHP

PHP и Apache имеют длинную совместную историю. Apache широконастраиваемый и имеет большое количество доступных [модулей](http://httpd.apache.org/docs/2.4/mod/) для расширения функциональности. Это очень популярный выбор для виртуальных хостингов и лёгкой установки PHP фреймворков и приложений с открытым исходным кодом, как WordPress. К сожалению, Apache использует больше ресурсов, чем nginx, и не может выдержать столько же посетителей одновременно.

Apache имеет несколько возможных конфигураций для запуска PHP. Самая популярная и лёгкая для установки [prefork MPM](http://httpd.apache.org/docs/2.4/mod/prefork.html) вместе с mod_php5. Хотя это не самое эффективное в отношении памяти решение, оно очень просто для установки и использования. Наверное, это лучшее решение, если вы не хотите углубляться в серверное администратирование. Если вы хотите использовать mod_php5, вы обязаны использовать prefork MPM.

Если вы хотите получить больше производительности и стабильности с Apache, тогда вы можете взглянуть на ту же FPM систему, как в nginx и запустить [worker MPM](http://httpd.apache.org/docs/2.4/mod/worker.html) или [event MPM](http://httpd.apache.org/docs/2.4/mod/event.html), используя mod_fastcgi или mod_fcgid. Эта конфигурация позволит получить существенную экономию в памяти и будет намного быстрее, но потребует больше работы для установки.

* [Подробнее на Apache](http://httpd.apache.org/)
* [Подробнее о Multi-Processing Modules](http://httpd.apache.org/docs/2.4/mod/mpm_common.html)
* [Подробнее о mod_fastcgi](http://www.fastcgi.com/mod_fastcgi/docs/mod_fastcgi.html)
* [Подробнее о mod_fcgid](http://httpd.apache.org/mod_fcgid/)

### Виртуальный хостинг

PHP, благодаря своей популярности, установлен на большом количестве виртуальных хостингов. Очень трудно найти хостинг без установленного PHP, но очень важно убедиться в том, что установлена последняя версия. Виртуальные хостинги позволяют вам и другим разработчикам развертывать веб-сайты на одной машине. Достоинством виртуального хостинга является его низкая цена. Недостатком &mdash; то, что вы не знаете, чем будут заниматься ваши соседи; сильно загружая сервер или открывая бреши в безопасности. Если бюджет вашего проекта позволяет избежать использования Виртуальных хостингов, то рассмотрите другие варианты.

### Построение и развёртывание вашего приложения

Если вы обновляете структуру базы данных вручную или запускаете вручную тесты перед обновлением ваших файлов, то подумайте дважды! С каждой дополнительной необходимой ручной задачей для развёртывания новой версии вашего приложения, потенциальный шанс возникновения фатальной ошибки возрастает. Делаете ли вы простое обновление, полный процесс сборки или стратегию непрерывной интеграции [автоматизация сборки](http://ru.wikipedia.org/wiki/%D0%90%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F_%D1%81%D0%B1%D0%BE%D1%80%D0%BA%D0%B8) &mdash; ваш друг.

Среди задач, которые вы, возможно, захотите автоматизировать:

* Управление зависимостями
* Компиляция, минификация файлов (assets)
* Запуск тестов
* Создание документации
* Запаковка
* Развёртывание


#### Создание инструментов автоматизации

Инструменты построения &mdash; коллекция скриптов, которые обрабатывают общие задачи развёртки приложений. Инструменты постройки не являются частью вашего приложения, они взаимодействуют с вашим приложением &laquo;извне&raquo;.

Существует большое количество инструментов с открытым исходным кодом, которые могут помочь вам автоматизировать процесс постройки, некоторые написаны на PHP, другие на других языках. Это не должно удерживать вас от их использования, если они лучше подходят под задачу. Вот несколько примеров:

[Phing](http://www.phing.info/) самый простой путь, чтобы начать автоматическую развёртку в мире PHP. С Phing вы можете контролировать ваш процесс запаковки, развёртки или тестирования с помощью простого построечного XML файла. Phing (который базируется на [Apache Ant](http://ant.apache.org/)) предоставляет богатый набор задач, часто необходимых для установки или обновления веб приложения, и может быть расширен дополнительными нестандартными задачами, написанными на PHP.

[Capistrano](https://github.com/capistrano/capistrano/wiki) &mdash; система для *начинающих-профессиональных разработчиков* для исполнения команд в структуризованном, воспроизводимом пути на одной или многих удалённых машинах. Предварительно он настроен для развёртки приложений Ruby on Rails. Как бы то ни было люди **успешно развёртывают и PHP приложения** с ним. Успех использования Capistrano зависит на умении работы с Ruby и Rake.

Сообщение в блоге Dave Gardner [PHP Deployment with Capistrano](http://www.davegardner.me.uk/blog/2012/02/13/php-deployment-with-capistrano/) является хорошей отправной точкой для PHP разработчиков, заинтересованных в Capistrano.

[Chef](http://www.opscode.com/chef/) является нечто большим, чем просто фрэймворк развёртки. Это очень мощный интеграционный фрэймворк, основанный на Ruby, который не просто развёртывает ваше приложение, но и может построить всё серверное окружение или виртуальный сервер.

Ресурсы о Chef для PHP разработчиков:

* [Серия из трёх сообщений в блоге о развёртке LAMP приложения с Chef, Vagrant и EC2](http://www.jasongrimes.org/2012/06/managing-lamp-environments-with-chef-vagrant-and-ec2-1-of-3/)
* [Книга рецептов Chef который устанавливает и настраивает PHP 5.3 и менеджер пакетов PEAR](https://github.com/opscode-cookbooks/php)

Для дальнейшего изучения:

* [Автоматизация ваших проектов с Apache Ant](http://net.tutsplus.com/tutorials/other/automate-your-projects-with-apache-ant/)
* [Maven](http://maven.apache.org/), построечный фрэймворк, основанный на Apache Ant; [как использовать его с PHP](http://www.php-maven.org/)

#### Непрерывная интеграция

> Непрерывная интеграция &mdash; это практика разработки программного обеспечения, при которой члены команды объединяют их
> работу очень часто, обычно каждый член команды объединяет как минимум ежедневно &mdash; что приводит к нескольким
> объединениям в день. Многие команды считают, что данный подход позволяет значительно сократить интеграционные
> проблемы и позволяет им разрабатывать совместный продукт быстрее.

*&mdash; Martin Fowler*

Существуют разные пути, для осуществления непрерывной интеграции для PHP. Недавно [Travis CI](https://travis-ci.org/) закончил великолепную работу по созданию непрерывной интеграции, реально даже для маленьких проектов. Travis CI &mdash; сервис непрерывной интеграции для сообщества с открытым исходным кодом. Оно интегрируется с GitHub и предлагает первоклассную поддержку для многих языков, включая PHP.

Heroku позволяет использовать непрерывную интеграцию для поставки приложения. Каждое изменение в коде или в окружении - это новая версия приложения. Интеграция с GitHub позволяет автоматизировать процесс. Когда в ветке происходит изменение, то Heroku запускает сборку приложения

Для дальнейшего изучения:

* [Что такое непрерывная интеграция?](https://aws.amazon.com/ru/devops/continuous-integration/)
* [Непрерывная интеграция с Jenkins](http://jenkins-ci.org/)
* [Непрерывная интеграция с Teamcity](http://www.jetbrains.com/teamcity/)
* [Heroku Getting Started with PHP](https://devcenter.heroku.com/categories/php-support)
