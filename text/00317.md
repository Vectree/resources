## Советы по повышению эффективности PHP

Author: Eric Higgins, Google Webmaster

PHP - очень популярный язык программирования, используемый на многих веб сайтах. В этой статье, мы надеемся помочь вам улучшить производительность ваших PHP скриптов с изменениями, которые вы можете внести очень быстро и безболезненно. Учтите, что производительность может сильно меняться в зависимости от версии PHP на вашем веб сервере и в целом от вашего кода.

### Профилируйте ваш код для обнаружения узких мест

Изречение Хора гласит, что преждевременная оптимизация - это корень всех зол, важно это учитывать, делая ваши веб сайты быстрее. Перед изменением вашего кода, вам нужно определить, что приводит к замедлению. Вы можете прочитать это руководство, а так-же многие другие по теме оптимизации PHP, в то время, как ваши проблемы могут зависить от базы данных или сети. [Профилируя ваш PHP код](http://www.google.com/webhp?#q=profiling+php), вы можете попробывать определить узкие места.

### Обновите ваш PHP

Команда разработчиков, которая поддерживает ядро PHP, внесло большое число важных исправлений производительности за последние несколько лет. Если на ваш веб сервер всё ещё работает со старыми версиями, как PHP 3 или PHP 4, то прежде всего вам нужно подумать об обновлении PHP, прежде чем вы попытаетесь оптимизировать ваш код.

* [Миграция от PHP 4 до PHP 5.0.x](http://www.php.net/manual/migration5.php)
* [Миграция от PHP 5.0.x до PHP 5.1.x](http://www.php.net/manual/migration51.php)
* [Миграция от PHP 5.1.x до PHP 5.2.x](http://www.php.net/manual/migration52.php)

### Кэширование

Использование модули кэширования, таких как Memcache, или шаблонизаторов, которые поддерживают кэширование, таких как Smarty, может улучшить производительность ваших веб сайтов с помощью кэширования результатов запросов к базам данных или отрендеренных страниц.

### Использование буферизации вывода

PHP использует буффер памяти, чтобы сохранить все данные, которые ваш скрипт пытается вывести. Этот буффер может сделать ваши страницы визуально медленными, поскольку вашим пользователям придётся ждать пока буффер заполнится перед тем, как он отправит какие-либо данные. К счастью, вы можете сделать некоторые изменения, которые заставят PHP вернуть выводной буффер раньше, а так-же чаще, что сделает ваш сайт быстрее для ваших пользователей.

* [Контроль выводного буффера](http://www.php.net/manual/book.outcontrol.php)

### Избегайте написания наивных геттеров и сеттеров

Когда вы пишите классы в PHP, вы можете сохранить время и повысить скорость ваших скриптов, работая со свойствами объекта напрямую, вместо написания наивных сеттеров и геттеров. В следующем примере, класс dog использует методы `setName()` и `getName()` для доступа к свойству `name`.

```php
<?php

class dog {
  public $name = '';

  public function setName($name) {
    $this->name = $name;
  }

  public function getName() {
    return $this->name;
  }
}
```

Имейте в виду, что `setName()` и `getName()` не делают большего, чем сохраняют и возвращают свойство `name`, соответственно.

```php
<?php

$rover = new dog();
$rover->setName('rover');
echo $rover->getName();

```

Установка и вызов свойства `name` напрямую может позволить скрипту работать до 100% быстрее, так-же, как и сократить время разработки.

```php
$rover = new dog();
$rover->name = 'rover';
echo $rover->name;
```

### Не копируйте переменные без причины

Иногда новички в PHP пытаются сделать их код "чище", копируя предустановленные переменные в переменные с более короткими именами, перед работой с ними. Это приводит к увеличенному потреблению памяти(когда переменные переназначаются), а так-же к замедлению скриптов. В следующем примере, что происходит если пользователь вставил 512KB символов в поле textarea. Это исполнение приведет к потреблению примерно 1MB памяти.

```php
<?php

$description = strip_tags($_POST['description']);
echo $description;
```

Нет причины копировать переменную в примере выше. Вы можете просто сделать эту операцию одной линией и избежать сверх-потребление памяти:

```php
<?php

echo strip_tags($_POST['description']);
```

### Избегайте SQL запросов в цикле

Частая ошибка - размещение SQL запросов в цикле. Это приводит к нескольким циклам запросов к базе данных, и существенно замедляет скрипты. В примере ниже, вы можете изменить цикл, чтобы он строил одиночный SQL запрос и вставлял всех пользователей за один раз.

```php
<?php

foreach ($userList as $user) {
  $query = 'INSERT INTO users (first_name,last_name) VALUES("' . $user['first_name'] . '", "' . $user['last_name'] . '")';
  mysql_query($query);
}
```

Выполняет запрос:

```sql
INSERT INTO users (first_name,last_name) VALUES("John", "Doe")
```

Вместо использования цикла, вы можете скомбинировать данные в одиночный запрос к базе.

```php
<?php

$userData = array();
foreach ($userList as $user) {
    $userData[] = '("' . $user['first_name'] . '", "' . $user['last_name'] . '")';
}
$query = 'INSERT INTO users (first_name,last_name) VALUES' . implode(',', $userData);
mysql_query($query);
```

Выполняет запрос:

```sql
INSERT INTO users (first_name,last_name) VALUES("John", "Doe"),("Jane", "Doe")...
```

[Синтаксис MySQL INSERT](http://dev.mysql.com/doc/mysql/ru/insert.html)

### Дополнительные руководства

[PHP Memcache модуль](http://www.php.net/memcache)
[Шаблонизатор Smarty](http://www.smarty.net/)
